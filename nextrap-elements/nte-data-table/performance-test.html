<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NTE Data Table Performance Test</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background-color: #f5f5f5;
      }

      .test-container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .test-header {
        padding: 20px;
        background: #007bff;
        color: white;
      }

      .test-header h1 {
        margin: 0;
        font-size: 24px;
        font-weight: 500;
      }

      .test-content {
        padding: 20px;
      }

      .controls {
        margin-bottom: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 4px;
        border: 1px solid #e9ecef;
      }

      .controls button {
        margin-right: 10px;
        padding: 8px 16px;
        border: 1px solid #007bff;
        background: white;
        color: #007bff;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
      }

      .controls button:hover {
        background: #007bff;
        color: white;
      }

      .performance-info {
        margin-bottom: 20px;
        padding: 15px;
        background: #e8f5e8;
        border-radius: 4px;
        border: 1px solid #4caf50;
      }

      .data-table-wrapper {
        height: 400px;
        border: 1px solid #dee2e6;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <div class="test-header">
        <h1>NTE Data Table Performance Test</h1>
      </div>

      <div class="test-content">
        <div class="performance-info">
          <h3>Performance Metrics</h3>
          <p><strong>Load Time:</strong> <span id="load-time">Measuring...</span></p>
          <p><strong>Render Time:</strong> <span id="render-time">Measuring...</span></p>
          <p><strong>Memory Usage:</strong> <span id="memory-usage">Measuring...</span></p>
          <p><strong>FPS:</strong> <span id="fps">Measuring...</span></p>
        </div>

        <div class="controls">
          <button onclick="addRows(10)">Add 10 Rows</button>
          <button onclick="addRows(50)">Add 50 Rows</button>
          <button onclick="addRows(100)">Add 100 Rows</button>
          <button onclick="clearTable()">Clear Table</button>
          <button onclick="testResize()">Test Column Resize</button>
          <button onclick="measurePerformance()">Measure Performance</button>
        </div>

        <div class="data-table-wrapper">
          <nte-data-table
            id="performance-data-table"
            localStorage-key="performance-test-columns"
            default-column-width="120"
            min-column-width="80"
            max-column-width="300"
            enable-column-resize="true"
          >
            <table class="data-table-table">
              <thead>
                <tr>
                  <th style="width: 50px">#</th>
                  <th style="width: 40px"></th>
                  <th>Title</th>
                  <th>Assignee</th>
                  <th>Status</th>
                  <th>Priority</th>
                  <th>Start Date</th>
                  <th>Due Date</th>
                  <th>Progress</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="table-body">
                <!-- Rows will be added here -->
              </tbody>
            </table>
          </nte-data-table>
        </div>
      </div>
    </div>

    <script type="module">
      import './src/components/nte-data-table/nte-data-table.ts';

      let rowCounter = 0;
      let performanceData = {
        loadStart: 0,
        loadEnd: 0,
        renderStart: 0,
        renderEnd: 0,
      };

      // Performance measurement
      function measurePerformance() {
        const loadTime = performanceData.loadEnd - performanceData.loadStart;
        const renderTime = performanceData.renderEnd - performanceData.renderStart;

        document.getElementById('load-time').textContent = `${loadTime.toFixed(2)}ms`;
        document.getElementById('render-time').textContent = `${renderTime.toFixed(2)}ms`;

        // Memory usage (if available)
        if ('memory' in performance) {
          const memory = performance.memory;
          const memoryMB = (memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
          document.getElementById('memory-usage').textContent = `${memoryMB} MB`;
        } else {
          document.getElementById('memory-usage').textContent = 'Not available';
        }
      }

      // FPS measurement
      let frameCount = 0;
      let lastTime = performance.now();

      function measureFPS() {
        frameCount++;
        const currentTime = performance.now();

        if (currentTime - lastTime >= 1000) {
          const fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
          document.getElementById('fps').textContent = `${fps} FPS`;
          frameCount = 0;
          lastTime = currentTime;
        }

        requestAnimationFrame(measureFPS);
      }

      // Row generation
      function generateRow(number) {
        const statuses = ['Lead', 'Offer Sent', 'Invoice Sent', 'Cancelled'];
        const priorities = ['High', 'Medium', 'Low'];
        const assignees = ['JD', 'JS', 'MJ', 'AL', 'RK', 'SC', 'DW', 'EM', 'TL', 'HC'];

        const status = statuses[Math.floor(Math.random() * statuses.length)];
        const priority = priorities[Math.floor(Math.random() * priorities.length)];
        const assignee = assignees[Math.floor(Math.random() * assignees.length)];

        return `
        <tr>
          <td class="row-number">${number}</td>
          <td><div class="row-checkbox" onclick="toggleCheckbox(this)"></div></td>
          <td>Project ${number} - Performance Test</td>
          <td><div class="avatar">${assignee}</div> ${assignee}</td>
          <td><span class="status-tag status-${status.toLowerCase().replace(' ', '-')}">${status}</span></td>
          <td><span class="priority-${priority.toLowerCase()}">${priority}</span></td>
          <td>Dec ${Math.floor(Math.random() * 30) + 1}, 2024</td>
          <td>Jan ${Math.floor(Math.random() * 30) + 1}, 2025</td>
          <td>${Math.floor(Math.random() * 100)}%</td>
          <td><button>Edit</button></td>
        </tr>
      `;
      }

      // Add rows function
      window.addRows = function (count) {
        const tbody = document.getElementById('table-body');
        const startTime = performance.now();

        const fragment = document.createDocumentFragment();

        for (let i = 0; i < count; i++) {
          rowCounter++;
          const row = document.createElement('tr');
          row.innerHTML = generateRow(rowCounter);
          fragment.appendChild(row);
        }

        tbody.appendChild(fragment);

        const endTime = performance.now();
        console.log(`Added ${count} rows in ${(endTime - startTime).toFixed(2)}ms`);
      };

      // Clear table function
      window.clearTable = function () {
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = '';
        rowCounter = 0;
      };

      // Test resize function
      window.testResize = function () {
        const dataTable = document.getElementById('performance-data-table');
        const startTime = performance.now();

        // Test multiple column resizes
        for (let i = 0; i < 10; i++) {
          dataTable.setColumnWidth('Title', 150 + i * 10);
        }

        const endTime = performance.now();
        console.log(`Resized columns in ${(endTime - startTime).toFixed(2)}ms`);
      };

      // Measure performance function
      window.measurePerformance = function () {
        measurePerformance();
      };

      // Checkbox toggle function
      window.toggleCheckbox = function (checkbox) {
        checkbox.classList.toggle('checked');
      };

      // Performance monitoring
      document.addEventListener('DOMContentLoaded', function () {
        performanceData.loadStart = performance.now();

        // Add initial rows
        addRows(20);

        performanceData.loadEnd = performance.now();
        performanceData.renderStart = performance.now();

        // Wait for render to complete
        requestAnimationFrame(() => {
          performanceData.renderEnd = performance.now();
          measurePerformance();
        });

        // Start FPS monitoring
        measureFPS();
      });
    </script>
  </body>
</html>
