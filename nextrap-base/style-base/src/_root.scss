@use './../variables' as *;
@use 'sass:math';
@use 'sass:color';

@function _linear-channel($c) {
  @if $c < 0.03928 {
    @return math.div($c, 12.92);
  }

  @return math.pow(math.div($c + 0.055, 1.055), 2.4);
}

@function luminance($color) {
  $r: math.div(color.channel($color, 'red', $space: rgb), 255);
  $g: math.div(color.channel($color, 'green', $space: rgb), 255);
  $b: math.div(color.channel($color, 'blue', $space: rgb), 255);

  $r: _linear-channel($r);
  $g: _linear-channel($g);
  $b: _linear-channel($b);

  @return $r * 0.2126 + $g * 0.7152 + $b * 0.0722;
}

@function contrast($color1, $color2) {
  $l1: luminance($color1) + 0.05;
  $l2: luminance($color2) + 0.05;

  @if $l1 > $l2 {
    @return math.div($l1, $l2);
  } @else {
    @return math.div($l2, $l1);
  }
}

/// Return an accessible text color for a background color.
/// Usage: text-on($bg) or text-on($bg, $fallback)
@function text-on($bg, $fallback: $white) {
  @if contrast($bg, $text) > 4.5 {
    @return $text;
  } @else {
    @return $fallback;
  }
}

$text: $black !default;

// Calculate if contrast is needed (use helper to avoid deprecated if())
$text-on-primary: text-on($primary) !default;
$text-on-secondary: text-on($secondary) !default;

$text-on-accent: text-on($accent) !default;
$text-on-success: text-on($success) !default;
$text-on-info: text-on($info) !default;
$text-on-warning: text-on($warning) !default;
$text-on-danger: text-on($danger) !default;
$text-on-light: text-on($light, $black) !default;
$text-on-dark: text-on($dark) !default;
$text-on-white: text-on($white, $black) !default;
$text-on-black: text-on($black) !default;
$background: $white !default;

// Register the css variables

:root {
  --nt-primary: #{$primary};
  --nt-primary-subtle: #{$primary-subtle};
  --nt-primary-emphasis: #{$primary-emphasis};

  --nt-secondary: #{$secondary};
  --nt-secondary-subtle: #{$secondary-subtle};
  --nt-secondary-emphasis: #{$secondary-emphasis};

  --nt-accent: #{$accent};
  --nt-accent-subtle: #{$accent-subtle};
  --nt-accent-emphasis: #{$accent-emphasis};

  --nt-success: #{$success};
  --nt-success-subtle: #{$success-subtle};
  --nt-success-emphasis: #{$success-emphasis};

  --nt-info: #{$info};
  --nt-info-subtle: #{$info-subtle};
  --nt-info-emphasis: #{$info-emphasis};

  --nt-warning: #{$warning};
  --nt-warning-subtle: #{$warning-subtle};
  --nt-warning-emphasis: #{$warning-emphasis};

  --nt-danger: #{$danger};
  --nt-danger-subtle: #{$danger-subtle};
  --nt-danger-emphasis: #{$danger-emphasis};

  --nt-light: #{$light};
  --nt-light-subtle: #{$light-subtle};
  --nt-light-emphasis: #{$light-emphasis};

  --nt-dark: #{$dark};
  --nt-dark-subtle: #{$dark-subtle};
  --nt-dark-emphasis: #{$dark-emphasis};

  --nt-white: #{$white};
  --nt-black: #{$black};

  --nt-body: #{$body};
  --nt-body-secondary: #{$body-secondary};
  --nt-body-tertiary: #{$body-tertiary};

  // Text colors
  --nt-text: #{$text};
  //--nt-text-rgb: #{hex2rgb($text)};

  --nt-text-on-primary: #{$text-on-primary};
  --nt-text-on-secondary: #{$text-on-secondary};
  --nt-text-on-accent: #{$text-on-accent};
  --nt-text-on-success: #{$text-on-success};
  --nt-text-on-info: #{$text-on-info};
  --nt-text-on-warning: #{$text-on-warning};
  --nt-text-on-danger: #{$text-on-danger};
  --nt-text-on-light: #{$text-on-light};
  --nt-text-on-dark: #{$text-on-dark};
  --nt-text-on-white: #{$text-on-white};
  --nt-text-on-black: #{$text-on-black};
  --nt-background: #{$background};

  --nt-link: #{$link-color};
  --nt-link-on-dark: #{$link-on-dark};
  --nt-text-decoration-link: #{$text-decoration_link};

  --nt-font-family-base: #{$font-family-base};
  --nt-font-family-header: #{$font-family-header};
  --nt-font-size-base: #{$font-size-base};
  --nt-font-size-header: #{$font-size-header};
  --nt-header: #{header};

  --nt-font-size-small: #{$font-size-small};

  // Spacing
  --nt-gap: #{$gap};

  --nt-border-radius: 0.25rem;
  --nt-border-width: 1px;

  --nt-space: #{$space};
  // Create --nt-space-1-5 variables (Multiplier from bootstrap)
  @each $i, $val in $spaceMap {
    --nt-space-#{$i}: calc(var(--nt-space) * #{$val});
  }

  --nt-content-space: #{$content-space};
  // Create --nt-content-space-1-5 variables
  @each $i, $val in $spaceMap {
    --nt-content-space-#{$i}: calc(var(--nt-content-space) * #{$val});
  }

  // =============== FONT SIZES =============== //
  // Font size
  @each $i, $val in $fontSizeMap {
    --nt-fs-#{$i}: calc(var(--nt-font-size-base) * #{$val});
  }

  // header font size
  @each $i, $val in $headerFontSizeMap {
    --nt-fs-h#{$i}: calc(var(--nt-font-size-header) * #{$val});
  }

  --nt-scroll-padding-top: calc(0.33 * 100vh); // Scroll element to upper 1/3 of the viewport height

  // Display font size
}
